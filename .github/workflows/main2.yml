name: Update file on PR merge
on:
  pull_request:
    branches:
      - main
    types: closed

jobs:
  update_date:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Amend the last commit
        run: |
          git config --global user.email "mateuszsobota13@gmail.com"
          git config --global user.name "Mateusz3124"
          git fetch origin main
          git branch -a -r
          git checkout main
          git pull
          current_version=$(cat WebApi/version)
          new_version=$(echo "$current_version" | awk -F. '{$NF = $NF + 1;} 1' | sed 's/ /./g')
          echo "$new_version" > WebApi/version
          cat WebApi/version
          git add WebApi/version
          git commit --amend
          git status
          git log
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
